<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SendIT - Transfert</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* Emp√™che le flash de contenu non styl√© (FOUC) */
        .screen { display: none; opacity: 0; }
        .screen.active { display: block; opacity: 1; }
    </style>
</head>
<body>
    <div id="toast-container" class="toast-container"></div>
    
    <div class="container">
        
        <div id="home-screen" class="screen active">
            <div class="header">
                <div class="logo">
                    <span>üîê</span>
                    <h1>SendIT</h1>
                </div>
                <p class="tagline">Partagez vos fichiers. Simplement. S√©curis√©.</p>
            </div>

            <div class="main-buttons">
                <button class="btn btn-primary" onclick="showSendScreen()">
                    <span class="btn-icon">üì§</span>
                    <span class="btn-text">Envoyer</span>
                </button>
                <button class="btn btn-success" onclick="showReceiveScreen()">
                    <span class="btn-icon">üì•</span>
                    <span class="btn-text">Recevoir</span>
                </button>
            </div>

            <div class="security-info">
                <h3>üõ°Ô∏è Confidentialit√© garantie</h3>
                <ul>
                    <li>Chiffrement de bout en bout (XSalsa20)</li>
                    <li>Aucun stockage sur nos serveurs</li>
                    <li>Cl√©s √©ph√©m√®res uniques</li>
                    <li>Aucun tra√ßage, aucune m√©tadonn√©e</li>
                </ul>
            </div>
        </div>

        <div id="send-screen" class="screen">
            <div class="header">
                <h2>Envoyer</h2>
            </div>

            <div class="file-selection">
                <input type="file" id="file-input" style="display: none;" onchange="handleFileSelect(event)">
                
                <button class="btn btn-primary" onclick="document.getElementById('file-input').click()" style="width: 100%;">
                    <span class="btn-icon">üìÅ</span>
                    <span class="btn-text">Choisir un fichier</span>
                </button>
                
                <div id="file-info" class="file-info" style="margin-top: 16px;"></div>
            </div>

            <div id="connection-code-section" class="connection-code-section" style="display: none;">
                <h3>Code de partage</h3>
                
                <div class="code-display">
                    <span id="connection-code" class="code">G√âN√âRATION...</span>
                </div>
                
                <button class="btn btn-secondary" onclick="copyCode()">
                    <span class="btn-icon">üìã</span>
                    <span class="btn-text">Copier</span>
                </button>
                
                <p class="hint">Ce code expire dans 10 minutes.</p>
                
                <div id="waiting-status" class="status-message" style="margin-top: 24px;">
                    <div class="spinner"></div>
                    <span>En attente du destinataire...</span>
                </div>
            </div>

            <div id="send-progress" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 16px; font-size: 18px;">Envoi en cours...</h3>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="send-progress-fill" class="progress-fill"></div>
                    </div>
                    <span id="send-progress-text" class="progress-text">0%</span>
                </div>
                <p class="status-message"><small>Ne fermez pas cette fen√™tre.</small></p>
            </div>

            <button class="btn btn-back" onclick="showHomeScreen()">Retour</button>
        </div>

        <div id="receive-screen" class="screen">
            <div class="header">
                <h2>Recevoir</h2>
            </div>

            <div class="code-input-section">
                <input type="text" 
                       id="room-code-input" 
                       class="code-input" 
                       placeholder="000-000" 
                       autocomplete="off" 
                       autocorrect="off" 
                       autocapitalize="off" 
                       spellcheck="false">
                
                <button class="btn btn-primary" onclick="joinRoom()" style="width: 100%;">
                    <span class="btn-icon">üîó</span>
                    <span class="btn-text">Rejoindre</span>
                </button>
            </div>

            <div id="receive-progress" style="display: none;">
                <div id="receive-file-info" class="file-info" style="margin-bottom: 20px;"></div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="receive-progress-fill" class="progress-fill"></div>
                    </div>
                    <span id="receive-progress-text" class="progress-text">0%</span>
                </div>
                <p class="status-message"><small>D√©chiffrement en cours...</small></p>
            </div>

            <button class="btn btn-back" onclick="showHomeScreen()">Retour</button>
        </div>

        <div id="complete-screen" class="screen">
            <div class="header">
                <h2>Termin√©</h2>
            </div>

            <div class="success-message">
                <div class="success-icon">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                <p>Le transfert est termin√©.<br>Le fichier a √©t√© s√©curis√©.</p>
            </div>

            <button class="btn btn-secondary" onclick="showHomeScreen()">
                <span class="btn-text">Retour √† l'accueil</span>
            </button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/tweetnacl.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/socket.io.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    
    <script>
        // Surcharge ou ajout de la fonction showToast pour matcher la structure CSS
        window.originalShowToast = window.showToast || function(){};
        
        window.showToast = function(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // Ic√¥nes bas√©es sur le type
            let icon = '‚ÑπÔ∏è';
            if (type === 'success') icon = '‚úì'; // ou SVG
            if (type === 'error') icon = '‚úï';
            
            // Structure HTML attendue par le CSS "Apple"
            toast.innerHTML = `
                <span class="toast-icon" style="font-weight:bold;">${icon}</span>
                <div class="toast-content">
                    <div class="toast-title">${message}</div>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Animation de sortie
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px) scale(0.95)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        };
    </script>
</body>
</html>